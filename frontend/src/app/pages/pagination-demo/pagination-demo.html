<div class="pagination-demo-container">
  <!-- Header -->
  <div class="demo-header">
    <h1>üìÑ Paginaci√≥n y Scroll Infinito</h1>
    <p>TAREA 4: Dos estrategias para cargar datos en listas largas</p>
  </div>

  <!-- Mode Selector -->
  <div class="mode-selector">
    <button 
      class="mode-btn"
      [class.active]="viewMode() === 'pagination'"
      (click)="setViewMode('pagination')"
    >
      üìã Paginaci√≥n Cl√°sica
    </button>
    <button 
      class="mode-btn"
      [class.active]="viewMode() === 'infinite'"
      (click)="setViewMode('infinite')"
    >
      ‚ôæÔ∏è Infinite Scroll
    </button>
  </div>

  <!-- ==========================================
       PAGINACI√ìN CL√ÅSICA
       ========================================== -->
  @if (viewMode() === 'pagination') {
    <section class="pagination-section">
      <div class="section-header">
        <h2>üìã Paginaci√≥n Cl√°sica</h2>
        <p>
          Carga una p√°gina a la vez. Los botones permiten navegar entre p√°ginas.
          Ideal para tablas de administraci√≥n y b√∫squedas con filtros.
        </p>
      </div>

      <!-- Loading overlay para paginaci√≥n -->
      @if (paginationState().loading) {
        <div class="loading-overlay">
          <div class="spinner"></div>
          <p>Cargando p√°gina {{ paginationState().page }}...</p>
        </div>
      }

      <!-- Lista de productos -->
      <div class="products-grid" [class.loading]="paginationState().loading">
        @for (product of paginationState().data; track trackById($index, product)) {
          <div class="product-card">
            <div class="product-icon">{{ product.image }}</div>
            <div class="product-info">
              <h3>{{ product.name }}</h3>
              <p class="category">{{ product.category }}</p>
              <p class="price">{{ product.price | currency:'EUR' }}</p>
            </div>
          </div>
        }
      </div>

      <!-- Empty State -->
      @if (!paginationState().loading && paginationState().data.length === 0) {
        <div class="empty-state">
          <span>üì≠</span>
          <p>No hay productos en esta p√°gina</p>
        </div>
      }

      <!-- Controles de paginaci√≥n -->
      <div class="pagination-controls">
        <!-- Bot√≥n Anterior -->
        <button 
          class="pagination-btn"
          (click)="previousPage()"
          [disabled]="!canGoPrevious() || paginationState().loading"
        >
          ‚óÄ Anterior
        </button>

        <!-- N√∫meros de p√°gina -->
        <div class="page-numbers">
          @if (pageNumbers()[0] > 1) {
            <button class="page-btn" (click)="goToPage(1)">1</button>
            @if (pageNumbers()[0] > 2) {
              <span class="ellipsis">...</span>
            }
          }
          
          @for (pageNum of pageNumbers(); track pageNum) {
            <button 
              class="page-btn"
              [class.active]="pageNum === paginationState().page"
              (click)="goToPage(pageNum)"
              [disabled]="paginationState().loading"
            >
              {{ pageNum }}
            </button>
          }
          
          @if (pageNumbers()[pageNumbers().length - 1] < totalPages()) {
            @if (pageNumbers()[pageNumbers().length - 1] < totalPages() - 1) {
              <span class="ellipsis">...</span>
            }
            <button class="page-btn" (click)="goToPage(totalPages())">
              {{ totalPages() }}
            </button>
          }
        </div>

        <!-- Bot√≥n Siguiente -->
        <button 
          class="pagination-btn"
          (click)="nextPage()"
          [disabled]="!canGoNext() || paginationState().loading"
        >
          Siguiente ‚ñ∂
        </button>
      </div>

      <!-- Info de paginaci√≥n -->
      <div class="pagination-info">
        <p>
          P√°gina <strong>{{ paginationState().page }}</strong> de <strong>{{ totalPages() }}</strong>
          ¬∑ Total: <strong>{{ paginationState().total }}</strong> productos
          ¬∑ Mostrando <strong>{{ paginationState().pageSize }}</strong> por p√°gina
        </p>
      </div>
    </section>
  }

  <!-- ==========================================
       INFINITE SCROLL
       ========================================== -->
  @if (viewMode() === 'infinite') {
    <section class="infinite-section">
      <div class="section-header">
        <h2>‚ôæÔ∏è Infinite Scroll</h2>
        <p>
          Carga autom√°tica al hacer scroll. Usa IntersectionObserver para detectar
          cu√°ndo el usuario llega al final. Ideal para feeds y cat√°logos.
        </p>
      </div>

      <!-- Contador de elementos cargados -->
      <div class="load-counter">
        <span class="counter-value">{{ infiniteState().data.length }}</span>
        <span class="counter-label">productos cargados</span>
      </div>

      <!-- Lista de productos (scroll container) -->
      <div class="infinite-list">
        @for (product of infiniteState().data; track trackById($index, product)) {
          <div class="product-card-horizontal">
            <div class="product-icon">{{ product.image }}</div>
            <div class="product-info">
              <h3>{{ product.name }}</h3>
              <p class="description">{{ product.description }}</p>
              <div class="product-meta">
                <span class="category">{{ product.category }}</span>
                <span class="price">{{ product.price | currency:'EUR' }}</span>
                <span class="stock" [class.low]="product.stock < 10">
                  Stock: {{ product.stock }}
                </span>
              </div>
            </div>
          </div>
        }

        <!-- 
          ANCHOR ELEMENT para IntersectionObserver
          
          Este div vac√≠o se observa con IntersectionObserver.
          Cuando entra en el viewport, se dispara loadMore().
          Est√° al final de la lista, as√≠ que cuando el usuario
          hace scroll hasta aqu√≠, cargamos m√°s datos.
        -->
        <div #scrollAnchor class="scroll-anchor"></div>

        <!-- Loading indicator (solo en el footer) -->
        @if (infiniteState().loading) {
          <div class="infinite-loading">
            <div class="spinner-small"></div>
            <span>Cargando m√°s productos...</span>
          </div>
        }

        <!-- End of data message -->
        @if (infiniteState().eof && !infiniteState().loading) {
          <div class="end-of-data">
            <span>üèÅ</span>
            <p>No hay m√°s productos para cargar</p>
          </div>
        }
      </div>

      <!-- Manual load button (backup) -->
      @if (!infiniteState().eof && !infiniteState().loading) {
        <button class="load-more-btn" (click)="loadMore()">
          Cargar m√°s productos
        </button>
      }
    </section>
  }

  <!-- ==========================================
       DOCUMENTACI√ìN
       ========================================== -->
  <div class="info-section">
    <h2>üìö Documentaci√≥n - Tarea 4</h2>

    <div class="info-grid">
      <!-- Paginaci√≥n Cl√°sica -->
      <div class="info-card">
        <h3>üìã Paginaci√≥n Cl√°sica</h3>
        <p>Reemplaza los datos al cambiar de p√°gina.</p>
        
        <h4>Implementaci√≥n:</h4>
        <ul>
          <li>Query params: <code>page</code> y <code>pageSize</code></li>
          <li>Estado: <code>{{ '{' }} loading, data, total, page {{ '}' }}</code></li>
          <li>Loading bloquea toda la lista</li>
        </ul>
        
        <h4>Cu√°ndo usar:</h4>
        <ul>
          <li>‚úÖ Tablas de administraci√≥n</li>
          <li>‚úÖ B√∫squedas con filtros</li>
          <li>‚úÖ Cuando el usuario necesita ir a una p√°gina espec√≠fica</li>
        </ul>
      </div>

      <!-- Infinite Scroll -->
      <div class="info-card">
        <h3>‚ôæÔ∏è Infinite Scroll</h3>
        <p>Acumula datos al hacer scroll.</p>
        
        <h4>Implementaci√≥n:</h4>
        <ul>
          <li>IntersectionObserver detecta el anchor</li>
          <li>Estado: <code>{{ '{' }} loading, data, page, eof {{ '}' }}</code></li>
          <li>Loading solo en el footer</li>
        </ul>
        
        <h4>Cu√°ndo usar:</h4>
        <ul>
          <li>‚úÖ Feeds de redes sociales</li>
          <li>‚úÖ Cat√°logos de productos</li>
          <li>‚úÖ Listados de contenido continuo</li>
        </ul>
      </div>
    </div>

    <h3>üîÑ Loading States</h3>
    <div class="loading-comparison">
      <div class="comparison-item">
        <h4>Paginaci√≥n</h4>
        <p>
          Loading <strong>bloquea toda la lista</strong> porque los datos 
          se reemplazan completamente. Se muestra un spinner central.
        </p>
      </div>
      <div class="comparison-item">
        <h4>Infinite Scroll</h4>
        <p>
          Loading <strong>solo afecta al footer</strong> porque los datos 
          previos siguen visibles. Mejor experiencia de usuario.
        </p>
      </div>
    </div>

    <h3>‚ö†Ô∏è Flag EOF (End Of File)</h3>
    <p>
      En ambos casos, usamos un flag <code>eof</code> para detectar cuando 
      no hay m√°s datos. Esto evita llamadas innecesarias a la API y muestra 
      un mensaje al usuario.
    </p>
  </div>
</div>
