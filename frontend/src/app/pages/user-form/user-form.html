<div class="form-container">
  <header class="form-header">
    <a routerLink="/" class="back-button" (click)="onBackLinkClick($event)">‚Üê Volver</a>
    <h1>üìù Formulario de Usuario</h1>
    <p class="subtitle">Formularios Reactivos con Validaciones Personalizadas</p>
  </header>

  <form [formGroup]="userForm" (ngSubmit)="onSubmit($event)" class="user-form">
    
    <!-- Nombre -->
    <div class="form-field">
      <label for="name">Nombre *</label>
      <input 
        #nameInput
        id="name"
        formControlName="name" 
        placeholder="Juan P√©rez"
        [class.invalid]="isFieldInvalid('name')">
      
      @if (isFieldInvalid('name')) {
        <div class="error-message" role="alert">
          <span aria-hidden="true">‚ö†</span> {{ getErrorMessage('name') }}
        </div>
      }
    </div>

    <!-- Username -->
    <div class="form-field">
      <label for="username">Nombre de Usuario *</label>
      <input 
        id="username"
        formControlName="username" 
        placeholder="juanperez123"
        [class.invalid]="isFieldInvalid('username')">
      
      @if (username?.pending) {
        <div class="loading-message">
          ‚è≥ Comprobando disponibilidad...
        </div>
      }
      
      @if (isFieldInvalid('username')) {
        <div class="error-message" role="alert">
          <span aria-hidden="true">‚ö†</span> {{ getErrorMessage('username') }}
        </div>
      }
    </div>

    <!-- Email -->
    <div class="form-field">
      <label for="email">Email *</label>
      <input 
        id="email"
        type="email"
        formControlName="email" 
        placeholder="juan@ejemplo.com"
        [class.invalid]="isFieldInvalid('email')">
      
      @if (email?.pending) {
        <div class="loading-message">
          ‚è≥ Verificando email...
        </div>
      }
      
      @if (isFieldInvalid('email')) {
        <div class="error-message" role="alert">
          <span aria-hidden="true">‚ö†</span> {{ getErrorMessage('email') }}
        </div>
      }
    </div>

    <!-- Edad -->
    <div class="form-field">
      <label for="age">Edad *</label>
      <input 
        id="age"
        type="number"
        formControlName="age" 
        placeholder="25"
        [class.invalid]="isFieldInvalid('age')">
      
      @if (isFieldInvalid('age')) {
        <div class="error-message" role="alert">
          <span aria-hidden="true">‚ö†</span> {{ getErrorMessage('age') }}
        </div>
      }
    </div>

    <!-- NIF -->
    <div class="form-field">
      <label for="nif">NIF *</label>
      <input 
        id="nif"
        formControlName="nif" 
        placeholder="12345678Z"
        maxlength="9"
        [class.invalid]="isFieldInvalid('nif')">
      
      @if (isFieldInvalid('nif')) {
        <div class="error-message" role="alert">
          <span aria-hidden="true">‚ö†</span> {{ getErrorMessage('nif') }}
        </div>
      }
    </div>

    <!-- Tel√©fono -->
    <div class="form-field">
      <label for="telefono">Tel√©fono M√≥vil *</label>
      <input 
        id="telefono"
        formControlName="telefono" 
        placeholder="612345678"
        maxlength="9"
        [class.invalid]="isFieldInvalid('telefono')">
      
      @if (isFieldInvalid('telefono')) {
        <div class="error-message" role="alert">
          <span aria-hidden="true">‚ö†</span> {{ getErrorMessage('telefono') }}
        </div>
      }
    </div>

    <!-- C√≥digo Postal -->
    <div class="form-field">
      <label for="codigoPostal">C√≥digo Postal *</label>
      <input 
        id="codigoPostal"
        formControlName="codigoPostal" 
        placeholder="28001"
        maxlength="5"
        [class.invalid]="isFieldInvalid('codigoPostal')">
      
      @if (isFieldInvalid('codigoPostal')) {
        <div class="error-message" role="alert">
          <span aria-hidden="true">‚ö†</span> {{ getErrorMessage('codigoPostal') }}
        </div>
      }
    </div>

    <!-- Contrase√±a -->
    <div class="form-field">
      <label for="password">Contrase√±a *</label>
      <input 
        id="password"
        type="password"
        formControlName="password" 
        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
        [class.invalid]="isFieldInvalid('password')">
      
      @if (userForm.get('password')?.touched && getPasswordErrors().length > 0) {
        <div class="error-list">
          <p class="error-title">La contrase√±a debe cumplir:</p>
          <ul>
            @for (error of getPasswordErrors(); track error) {
              <li class="error-item">{{ error }}</li>
            }
          </ul>
        </div>
      }
    </div>

    <!-- Confirmar Contrase√±a -->
    <div class="form-field">
      <label for="confirmPassword">Confirmar Contrase√±a *</label>
      <input 
        id="confirmPassword"
        type="password"
        formControlName="confirmPassword" 
        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
        [class.invalid]="isFieldInvalid('confirmPassword')">
      
      @if (isFieldInvalid('confirmPassword')) {
        <div class="error-message" role="alert">
          <span aria-hidden="true">‚ö†</span> {{ getErrorMessage('confirmPassword') }}
        </div>
      }
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button 
        #submitButton
        type="submit" 
        class="btn-primary"
        [disabled]="userForm.invalid || userForm.pending">
        <span class="btn-icon">
          @if (userForm.pending) {
            ‚è≥
          } @else {
            ‚úì
          }
        </span>
        {{ userForm.pending ? 'Validando...' : 'Registrar Usuario' }}
      </button>
      <button 
        type="button" 
        class="btn-secondary"
        (click)="onReset()">
        <span class="btn-icon">‚Üª</span>
        Limpiar
      </button>
    </div>

    <!-- Estado del formulario -->
    <div class="form-status">
      <div class="status-item">
        <strong>Estado:</strong>
        @if (userForm.valid) {
          <span class="status-valid">‚úì V√°lido</span>
        } @else {
          <span class="status-invalid">‚úï Inv√°lido</span>
        }
      </div>
      <div class="status-item">
        <strong>Pristine:</strong> {{ userForm.pristine ? 'S√≠' : 'No' }}
      </div>
      <div class="status-item">
        <strong>Touched:</strong> {{ userForm.touched ? 'S√≠' : 'No' }}
      </div>
    </div>

  </form>

  <!-- Secci√≥n de teor√≠a -->
  <section class="theory-section">
    <h2>üìö Conceptos de Formularios Reactivos</h2>
    
    <div class="concept-grid">
      <div class="concept-card">
        <h3>FormBuilder</h3>
        <p>Servicio para crear FormGroup y FormControl program√°ticamente con sintaxis simplificada</p>
      </div>
      
      <div class="concept-card">
        <h3>FormGroup</h3>
        <p>Agrupa m√∫ltiples controles relacionados con validaci√≥n sincronizada</p>
      </div>
      
      <div class="concept-card">
        <h3>FormControl</h3>
        <p>Representa un campo individual con valor, estado (valid/invalid) y errores</p>
      </div>
      
      <div class="concept-card">
        <h3>Validadores S√≠ncronos</h3>
        <p>required, minLength, email, pattern, min, max - evaluaci√≥n instant√°nea</p>
      </div>
      
      <div class="concept-card">
        <h3>Cross-Field Validation</h3>
        <p>Validadores a nivel FormGroup que comparan m√∫ltiples campos</p>
      </div>
      
      <div class="concept-card">
        <h3>ValidationErrors</h3>
        <p>Objeto con claves de error personalizadas para mensajes espec√≠ficos</p>
      </div>
    </div>
  </section>
</div>
