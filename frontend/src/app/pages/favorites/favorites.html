<app-header />

<main class="favorites">
  <div class="favorites__container">
    
    <!-- T铆tulo con fondo verde -->
    <header class="favorites__header">
      <h1 class="favorites__title">Favoritos</h1>
    </header>

    <!-- Mensaje si no est谩 logueado -->
    @if (!isLoggedIn()) {
      <div class="favorites__login-prompt">
        <p> Inicia sesi贸n para guardar tus favoritos</p>
        <button 
          (click)="openLoginModal()" 
          class="favorites__login-btn"
          title="Ir a iniciar sesi贸n"
          aria-label="Iniciar sesi贸n para guardar favoritos">
          Iniciar sesi贸n
        </button>
      </div>
    }

    <!-- Tabs de filtro -->
    <nav class="favorites__tabs" aria-label="Filtrar favoritos">
      <button 
        class="favorites__tab"
        [class.favorites__tab--active]="activeTab() === 'all'"
        (click)="setTab('all')"
        title="Ver todos los favoritos"
        [attr.aria-label]="activeTab() === 'all' ? 'Todos los favoritos, tab activo' : 'Ver todos los favoritos'"
        [attr.aria-pressed]="activeTab() === 'all'">
        Todos
      </button>
      <button 
        class="favorites__tab"
        [class.favorites__tab--active]="activeTab() === 'teams'"
        (click)="setTab('teams')"
        title="Ver equipos favoritos"
        [attr.aria-label]="activeTab() === 'teams' ? 'Equipos favoritos, tab activo' : 'Ver equipos favoritos'"
        [attr.aria-pressed]="activeTab() === 'teams'">
        Equipos
      </button>
      <button 
        class="favorites__tab"
        [class.favorites__tab--active]="activeTab() === 'leagues'"
        (click)="setTab('leagues')"
        title="Ver ligas favoritas"
        [attr.aria-label]="activeTab() === 'leagues' ? 'Ligas favoritas, tab activo' : 'Ver ligas favoritas'"
        [attr.aria-pressed]="activeTab() === 'leagues'">
        Ligas
      </button>
      <button 
        class="favorites__tab"
        [class.favorites__tab--active]="activeTab() === 'players'"
        (click)="setTab('players')"
        title="Ver jugadores favoritos"
        [attr.aria-label]="activeTab() === 'players' ? 'Jugadores favoritos, tab activo' : 'Ver jugadores favoritos'"
        [attr.aria-pressed]="activeTab() === 'players'">
        Jugadores
      </button>
    </nav>

    <!-- Estado de carga -->
    @if (loading()) {
      <div class="favorites__loading">
        <div class="spinner"></div>
        <p>Cargando favoritos...</p>
      </div>
    }

    <!-- Lista de favoritos -->
    @if (!loading()) {
      <section class="favorites__content">
        @if (getFilteredFavorites().length > 0) {
          <div class="favorites-list">
            @for (fav of getFilteredFavorites(); track fav.type + fav.id) {
              <article 
                class="favorite-item"
                (click)="goToFavorite(fav)"
                tabindex="0"
                (keydown.enter)="goToFavorite(fav)"
                role="button"
                [title]="'Ver ' + fav.name"
                [attr.aria-label]="'Ver detalles de ' + fav.name">
                <div class="favorite-item__image-wrapper">
                  <img 
                    [src]="fav.image" 
                    [alt]="'Imagen de ' + fav.name"
                    class="favorite-item__image"
                    loading="lazy"
                    onerror="this.src='assets/images/default-logo.png'"
                  >
                </div>
                <div class="favorite-item__info">
                  <span class="favorite-item__name">{{ fav.name }}</span>
                  @if (fav.subtitle) {
                    <span class="favorite-item__subtitle">{{ fav.subtitle }}</span>
                  }
                </div>
                <span class="favorite-item__type" aria-hidden="true">{{ getTypeIcon(fav.type) }}</span>
                <button 
                  class="favorite-item__remove"
                  (click)="removeFavorite(fav, $event)"
                  [title]="'Quitar ' + fav.name + ' de favoritos'"
                  [attr.aria-label]="'Quitar ' + fav.name + ' de favoritos'">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </article>
            }
          </div>
        } @else {
          <div class="favorites__empty">
            <p>No tienes favoritos guardados</p>
            <p class="favorites__empty-hint">
              A帽ade equipos, ligas o jugadores a favoritos para verlos aqu铆
            </p>
          </div>
        }
      </section>
    }

  </div>
</main>

<app-footer />
