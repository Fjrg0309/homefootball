<div class="realtime-demo-container">
  <!-- Header -->
  <div class="demo-header">
    <h1>üîÑ WebSockets y Polling</h1>
    <p>TAREA 6 (OPCIONAL): Actualizaci√≥n de datos sin intervenci√≥n del usuario</p>
  </div>

  <!-- ==========================================
       PANEL DE CONTROL
       ========================================== -->
  <div class="control-panel">
    <div class="connection-status">
      <div class="status-indicator" [class.connected]="isConnected()">
        <span class="status-dot"></span>
        <span class="status-text">
          @switch (currentMode()) {
            @case ('websocket') { üîå WebSocket Conectado }
            @case ('polling') { üîÑ Polling Activo }
            @default { ‚≠ï Desconectado }
          }
        </span>
      </div>
      
      @if (connectionState().lastUpdate) {
        <span class="last-update">
          √öltima actualizaci√≥n: {{ connectionState().lastUpdate | date:'HH:mm:ss' }}
        </span>
      }
    </div>

    <div class="control-buttons">
      <!-- WebSocket Button -->
      <button 
        class="control-btn websocket"
        [class.active]="currentMode() === 'websocket'"
        (click)="connectWebSocket()"
        [disabled]="currentMode() === 'websocket'"
      >
        üîå Conectar WebSocket
      </button>

      <!-- Polling Button -->
      <button 
        class="control-btn polling"
        [class.active]="currentMode() === 'polling'"
        (click)="startPolling()"
        [disabled]="currentMode() === 'polling'"
      >
        üîÑ Iniciar Polling
      </button>

      <!-- Disconnect Button -->
      <button 
        class="control-btn disconnect"
        (click)="disconnect()"
        [disabled]="!isConnected()"
      >
        ‚èπÔ∏è Desconectar
      </button>
    </div>

    <!-- Polling Config -->
    @if (currentMode() === 'polling' || currentMode() === 'disconnected') {
      <div class="polling-config">
        <label>Intervalo de polling:</label>
        <div class="interval-buttons">
          @for (sec of [3, 5, 10, 15]; track sec) {
            <button 
              class="interval-btn"
              [class.active]="pollingInterval() === sec"
              (click)="setPollingInterval(sec)"
            >
              {{ sec }}s
            </button>
          }
        </div>
      </div>
    }
  </div>

  <!-- ==========================================
       ESTAD√çSTICAS
       ========================================== -->
  <div class="stats-bar">
    <div class="stat-item">
      <span class="stat-value">{{ connectionState().messageCount }}</span>
      <span class="stat-label">Mensajes recibidos</span>
    </div>
    <div class="stat-item">
      <span class="stat-value highlight">{{ unreadCount() }}</span>
      <span class="stat-label">Sin leer</span>
    </div>
    <div class="stat-item">
      <span class="stat-value">{{ notifications().length }}</span>
      <span class="stat-label">Total notificaciones</span>
    </div>
  </div>

  <!-- ==========================================
       LISTA DE NOTIFICACIONES
       ========================================== -->
  <div class="notifications-section">
    <div class="notifications-header">
      <h2>üì¨ Notificaciones en Tiempo Real</h2>
      <div class="notifications-actions">
        <button 
          class="action-btn"
          (click)="markAllAsRead()"
          [disabled]="unreadCount() === 0"
        >
          ‚úì Marcar todas le√≠das
        </button>
        <button 
          class="action-btn danger"
          (click)="clearNotifications()"
          [disabled]="notifications().length === 0"
        >
          üóëÔ∏è Limpiar
        </button>
      </div>
    </div>

    <!-- Empty State -->
    @if (notifications().length === 0) {
      <div class="empty-state">
        <span class="empty-icon">üì≠</span>
        <h3>No hay notificaciones</h3>
        <p>Conecta WebSocket o inicia Polling para recibir notificaciones en tiempo real</p>
      </div>
    }

    <!-- Notifications List -->
    @if (notifications().length > 0) {
      <div class="notifications-list">
        @for (notification of notifications(); track trackById($index, notification)) {
          <div 
            class="notification-item"
            [class.unread]="!notification.read"
            [attr.data-type]="notification.type"
            (click)="markAsRead(notification.id)"
          >
            <span class="notification-icon">{{ getNotificationIcon(notification.type) }}</span>
            <div class="notification-content">
              <h4>{{ notification.title }}</h4>
              <p>{{ notification.message }}</p>
              <span class="notification-time">{{ notification.timestamp | date:'HH:mm:ss' }}</span>
            </div>
            @if (!notification.read) {
              <span class="unread-badge"></span>
            }
          </div>
        }
      </div>
    }
  </div>

  <!-- ==========================================
       DOCUMENTACI√ìN
       ========================================== -->
  <div class="info-section">
    <h2>üìö Documentaci√≥n - Tarea 6 (Opcional)</h2>

    <div class="info-grid">
      <!-- WebSocket -->
      <div class="info-card websocket-card">
        <h3>üîå WebSocket</h3>
        <p>Conexi√≥n bidireccional persistente con el servidor.</p>
        
        <h4>Implementaci√≥n:</h4>
        <code>
import {{ '{' }} webSocket {{ '}' }} from 'rxjs/webSocket';

socket$ = webSocket('wss://api.example.com/ws');

// Escuchar mensajes
socket$.subscribe(msg => {{ '{' }}
  this.notifications = [msg, ...this.notifications];
{{ '}' }});

// Enviar mensaje
socket$.next({{ '{' }} type: 'subscribe', channel: 'products' {{ '}' }});
        </code>

        <h4>Cu√°ndo usar:</h4>
        <ul>
          <li>‚úÖ Chat en tiempo real</li>
          <li>‚úÖ Notificaciones push</li>
          <li>‚úÖ Paneles de monitoreo</li>
          <li>‚úÖ Juegos multijugador</li>
        </ul>
      </div>

      <!-- Polling -->
      <div class="info-card polling-card">
        <h3>üîÑ Polling</h3>
        <p>Peticiones HTTP peri√≥dicas al servidor.</p>
        
        <h4>Implementaci√≥n:</h4>
        <code>
import {{ '{' }} timer, switchMap {{ '}' }} from 'rxjs';

notifications$ = timer(0, 30000).pipe(
  switchMap(() => this.http.get('/api/notifications')),
  shareReplay(1)
);

// En template:
&#64;for (n of notifications$ | async) {{ '{' }} ... {{ '}' }}
        </code>

        <h4>Cu√°ndo usar:</h4>
        <ul>
          <li>‚úÖ API sin soporte WebSocket</li>
          <li>‚úÖ Datos que cambian poco</li>
          <li>‚úÖ Implementaci√≥n simple</li>
          <li>‚úÖ Menor complejidad server</li>
        </ul>
      </div>
    </div>

    <h3>‚öñÔ∏è Comparaci√≥n</h3>
    <div class="comparison-table">
      <div class="comparison-row header">
        <span>Aspecto</span>
        <span>WebSocket</span>
        <span>Polling</span>
      </div>
      <div class="comparison-row">
        <span>Conexi√≥n</span>
        <span>Persistente</span>
        <span>M√∫ltiples HTTP</span>
      </div>
      <div class="comparison-row">
        <span>Latencia</span>
        <span>Muy baja (~ms)</span>
        <span>Depende del intervalo</span>
      </div>
      <div class="comparison-row">
        <span>Eficiencia</span>
        <span>Alta (solo datos nuevos)</span>
        <span>Baja (pide todo)</span>
      </div>
      <div class="comparison-row">
        <span>Bidireccional</span>
        <span>‚úÖ S√≠</span>
        <span>‚ùå No (solo request)</span>
      </div>
      <div class="comparison-row">
        <span>Complejidad servidor</span>
        <span>Alta</span>
        <span>Baja (REST normal)</span>
      </div>
      <div class="comparison-row">
        <span>Firewall/Proxy</span>
        <span>‚ö†Ô∏è Puede bloquear</span>
        <span>‚úÖ Sin problemas</span>
      </div>
    </div>

    <h3>üéØ Resumen</h3>
    <p>
      Ambas t√©cnicas permiten <strong>actualizar datos sin intervenci√≥n del usuario</strong>. 
      WebSocket es ideal para casos de alta frecuencia (chat, gaming), mientras que 
      Polling es m√°s simple y compatible cuando los cambios son menos frecuentes.
    </p>
  </div>
</div>
