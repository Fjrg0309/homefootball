<app-header />

<main class="transfers">
  <div class="transfers__container">
    
    <!-- Título con fondo verde -->
    <header class="transfers__header">
      <h1 class="transfers__title">Últimos fichajes</h1>
    </header>

    <div class="transfers__layout">
      <!-- Botón para abrir sidebar en móvil -->
      <button 
        class="transfers__filter-toggle"
        (click)="toggleSidebar()"
        [class.transfers__filter-toggle--active]="sidebarOpen()"
        [title]="sidebarOpen() ? 'Cerrar buscador avanzado' : 'Abrir buscador avanzado'"
        [attr.aria-label]="sidebarOpen() ? 'Cerrar panel de filtros' : 'Abrir panel de filtros avanzados'"
        [attr.aria-expanded]="sidebarOpen()">
        Buscador avanzado
      </button>
      
      <!-- Sidebar de filtros -->
      <aside 
        class="transfers__sidebar"
        [class.transfers__sidebar--open]="sidebarOpen()">
        <h2 class="transfers__sidebar-title">Buscador avanzado</h2>
        
        <div class="transfers__filters">
          <!-- Filtro por equipo -->
          <div class="filter-group">
            <label class="filter-group__label" for="team-filter">Equipo</label>
            <input 
              type="text"
              id="team-filter"
              class="filter-group__input"
              placeholder="Nombre del equipo..."
              [value]="selectedTeam()"
              (input)="selectedTeam.set($any($event.target).value)"
              title="Escribir nombre de equipo para filtrar fichajes"
              aria-label="Filtrar fichajes por nombre de equipo"
            >
          </div>
          
          <!-- Filtro por competición -->
          <div class="filter-group">
            <label class="filter-group__label" for="competition-filter">Competición</label>
            <select 
              id="competition-filter"
              class="filter-group__select"
              [value]="selectedCompetition()"
              (change)="selectedCompetition.set($any($event.target).value)"
              title="Seleccionar competición para filtrar fichajes"
              aria-label="Filtrar fichajes por competición">
              <option value="">Todas</option>
              @for (comp of competitions(); track comp.id) {
                <option [value]="comp.id">{{ comp.name }}</option>
              }
            </select>
          </div>
          
          <!-- Mostrar solo favoritos -->
          <div class="filter-group filter-group--checkbox">
            <label class="filter-group__checkbox-label">
              <input 
                type="checkbox"
                class="filter-group__checkbox"
                [checked]="showOnlyFavorites()"
                (change)="showOnlyFavorites.set($any($event.target).checked)"
                title="Marcar para mostrar solo fichajes de tus favoritos"
                aria-label="Mostrar solo fichajes de equipos favoritos"
              >
              ¿Mostrar solo favoritos?
            </label>
          </div>
          
          <!-- Botones -->
          <div class="filter-group__actions">
            <button 
              class="filter-group__btn filter-group__btn--primary"
              (click)="applyFilters()"
              title="Aplicar filtros de búsqueda"
              aria-label="Buscar fichajes con los filtros seleccionados">
              Buscar
            </button>
            <button 
              class="filter-group__btn filter-group__btn--secondary"
              (click)="clearFilters()"
              title="Limpiar todos los filtros"
              aria-label="Limpiar filtros y mostrar todos los fichajes">
              Limpiar
            </button>
          </div>
        </div>
      </aside>

      <!-- Contenido principal -->
      <section class="transfers__content">
        <!-- Estado de carga -->
        @if (loading()) {
          <div class="transfers__loading">
            <div class="spinner"></div>
            <p>Cargando fichajes...</p>
          </div>
        }

        <!-- Lista de fichajes -->
        @if (!loading()) {
          @if (filteredTransfers().length > 0) {
            <div class="transfers-list">
              @for (transfer of filteredTransfers(); track transfer.id) {
                <article class="transfer-card">
                  <span 
                    class="transfer-card__name transfer-card__name--clickable"
                    (click)="goToPlayer(transfer.playerId)"
                    tabindex="0"
                    role="button"
                    [title]="'Ver ficha de ' + transfer.playerName"
                    [attr.aria-label]="'Ver detalles del jugador ' + transfer.playerName">
                    {{ transfer.playerName }}
                  </span>
                  
                  <div class="transfer-card__teams">
                    <div 
                      class="transfer-card__team"
                      (click)="goToTeam(transfer.fromTeam.id)"
                      tabindex="0"
                      role="button"
                      [title]="'Ver equipo ' + transfer.fromTeam.name"
                      [attr.aria-label]="'Ver detalles del equipo de origen: ' + transfer.fromTeam.name">
                      <img 
                        [src]="transfer.fromTeam.logo" 
                        [alt]="'Escudo del equipo de origen: ' + transfer.fromTeam.name"
                        class="transfer-card__team-logo"
                        loading="lazy"
                        onerror="this.src='assets/images/default-team.png'"
                      >
                    </div>
                    
                    <div class="transfer-card__arrow" aria-hidden="true">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                      </svg>
                    </div>
                    
                    <div 
                      class="transfer-card__team"
                      (click)="goToTeam(transfer.toTeam.id)"
                      tabindex="0"
                      role="button"
                      [title]="'Ver equipo ' + transfer.toTeam.name"
                      [attr.aria-label]="'Ver detalles del equipo de destino: ' + transfer.toTeam.name">
                      <img 
                        [src]="transfer.toTeam.logo" 
                        [alt]="'Escudo del equipo de destino: ' + transfer.toTeam.name"
                        class="transfer-card__team-logo"
                        loading="lazy"
                        onerror="this.src='assets/images/default-team.png'"
                      >
                    </div>
                  </div>
                  
                  <span class="transfer-card__fee">{{ transfer.fee }}</span>
                </article>
              }
            </div>
          } @else {
            <div class="transfers__empty">
              <p>No se encontraron fichajes con los filtros seleccionados</p>
            </div>
          }
        }
      </section>
    </div>

  </div>
</main>

<app-footer />
