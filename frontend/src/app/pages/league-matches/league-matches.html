<app-header />

<main class="league-matches">
  <div class="league-matches__container">
    
    <!-- Título con fondo verde -->
    <header class="league-matches__header">
      <h1 class="league-matches__title">Partidos - {{ leagueName() }}</h1>
    </header>

    <!-- Navegación de jornadas y temporada -->
    <nav class="date-navigation">
      <button class="date-navigation__btn date-navigation__btn--prev" (click)="goToPreviousRound()" [disabled]="loading() || isFirstRound()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#00D26A" stroke-width="2.5">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      
      <div class="date-navigation__center">
        <span class="date-navigation__date">{{ formattedRound() }}</span>
        @if (roundDate()) {
          <span class="date-navigation__subtext">{{ roundDate() }}</span>
        }
        @if (!isLastRound()) {
          <button class="date-navigation__today" (click)="goToLastRound()">Ir a última jornada</button>
        }
      </div>
      
      <button class="date-navigation__btn date-navigation__btn--next" (click)="goToNextRound()" [disabled]="loading() || isLastRound()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#00D26A" stroke-width="2.5">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
      
      <!-- Selector de temporada -->
      <div class="date-navigation__season">
        <label for="season-select" class="date-navigation__season-label">Temporada:</label>
        <select 
          id="season-select"
          class="date-navigation__season-select"
          [value]="season()"
          (change)="changeSeason($event)">
          @for (seasonYear of availableSeasons(); track seasonYear) {
            <option [value]="seasonYear">{{ seasonYear }}-{{ seasonYear + 1 }}</option>
          }
        </select>
      </div>
    </nav>

    <!-- Estado de carga -->
    @if (loading()) {
      <section class="league-matches__loading">
        <div class="spinner"></div>
        <p>Cargando partidos...</p>
      </section>
    }

    <!-- Error -->
    @if (error()) {
      <section class="league-matches__error">
        <p>{{ error() }}</p>
        <button class="league-matches__retry" (click)="loadMatchesForRound(currentRound())">
          Reintentar
        </button>
      </section>
    }

    <!-- Lista de partidos -->
    @if (!loading() && !error()) {
      <section class="league-matches__content">
        @if (matches().length === 0) {
          <div class="no-matches">
            <p class="no-matches__text">No hay partidos disponibles para esta jornada</p>
            <div class="no-matches__actions">
              @if (!isFirstRound()) {
                <button class="no-matches__btn" (click)="goToPreviousRound()">
                  ← Jornada anterior
                </button>
              }
              @if (!isLastRound()) {
                <button class="no-matches__btn" (click)="goToNextRound()">
                  Jornada siguiente →
                </button>
              }
            </div>
          </div>
        } @else {
          <div class="matches-list">
            @for (match of matches(); track match.id) {
              <article class="match-row" [class.match-row--live]="match.status === 'live'">
                <!-- Equipo local (clickeable) -->
                <a [routerLink]="['/equipo', match.homeTeamId]" 
                   class="match-row__team match-row__team--home" 
                   [class.match-row__team--winner]="getWinnerClass(match, 'home') === 'winner'"
                   (click)="$event.stopPropagation()">
                  <img [src]="match.homeLogo" [alt]="match.homeTeam" class="match-row__logo">
                  <span class="match-row__name">{{ match.homeTeam }}</span>
                </a>
                
                <!-- Marcador o Hora (enlace al partido) -->
                <a [routerLink]="['/partido', match.id]" class="match-row__center">
                  <span class="match-row__score" 
                        [class.match-row__score--live]="match.status === 'live'"
                        [class.match-row__score--upcoming]="match.status === 'upcoming'">
                    {{ getScoreDisplay(match) }}
                  </span>
                  @if (match.status !== 'upcoming') {
                    <span class="match-row__status" [class.match-row__status--live]="match.status === 'live'">
                      {{ getStatusText(match) }}
                    </span>
                  }
                </a>
                
                <!-- Equipo visitante (clickeable) -->
                <a [routerLink]="['/equipo', match.awayTeamId]" 
                   class="match-row__team match-row__team--away" 
                   [class.match-row__team--winner]="getWinnerClass(match, 'away') === 'winner'"
                   (click)="$event.stopPropagation()">
                  <span class="match-row__name">{{ match.awayTeam }}</span>
                  <img [src]="match.awayLogo" [alt]="match.awayTeam" class="match-row__logo">
                </a>
              </article>
            }
          </div>
        }
      </section>
    }

    <!-- Botón volver -->
    <nav class="league-matches__nav">
      <a [routerLink]="['/liga', leagueId()]" class="league-matches__back">
        ← Volver a {{ leagueName() }}
      </a>
    </nav>

  </div>
</main>

<app-footer />
