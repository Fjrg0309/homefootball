<form class="register-form" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
  <fieldset class="register-form__fieldset" [disabled]="isLoading()">
    <legend class="register-form__legend">Crear cuenta</legend>
    
    @if (errorMessage()) {
      <div class="register-form__error-banner" role="alert" aria-live="polite">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        {{ errorMessage() }}
      </div>
    }
    
    <!-- Nombre -->
    <section class="register-form__field-group">
      <label class="register-form__label" for="reg-name">
        Nombre <span class="register-form__required">*</span>
      </label>
      <input 
        class="register-form__input"
        [class.register-form__input--error]="isFieldInvalid('name')"
        type="text"
        id="reg-name"
        formControlName="name"
        placeholder="Tu nombre completo"
      />
      @if (isFieldInvalid('name')) {
        <span class="register-form__error">{{ getErrorMessage('name') }}</span>
      }
    </section>

    <!-- Email -->
    <section class="register-form__field-group">
      <label class="register-form__label" for="reg-email">
        Email <span class="register-form__required">*</span>
      </label>
      <input 
        class="register-form__input"
        [class.register-form__input--error]="isFieldInvalid('email')"
        type="email"
        id="reg-email"
        formControlName="email"
        placeholder="tu@email.com"
      />
      @if (isFieldInvalid('email')) {
        <span class="register-form__error">{{ getErrorMessage('email') }}</span>
      }
    </section>

    <!-- Contraseña -->
    <section class="register-form__field-group">
      <label class="register-form__label" for="reg-password">
        Contraseña <span class="register-form__required">*</span>
      </label>
      <input 
        class="register-form__input"
        [class.register-form__input--error]="isFieldInvalid('password')"
        type="password"
        id="reg-password"
        formControlName="password"
        placeholder="Mínimo 6 caracteres"
      />
      @if (isFieldInvalid('password')) {
        <span class="register-form__error">{{ getErrorMessage('password') }}</span>
      }
      
      <!-- Indicador de fortaleza de contraseña -->
      @if (passwordControl.value) {
        <section class="register-form__password-hints" aria-label="Requisitos de contraseña">
          <span [class.valid]="passwordControl.value.length >= 6">✓ 6+ caracteres</span>
          <span [class.valid]="passwordControl.value.match('[A-Z]')">✓ Mayúscula</span>
          <span [class.valid]="passwordControl.value.match('[a-z]')">✓ Minúscula</span>
          <span [class.valid]="passwordControl.value.match('[0-9]')">✓ Número</span>
          <span [class.valid]="passwordControl.value.match('[!@#$%^&*]')">✓ Especial</span>
        </section>
      }
    </section>

    <!-- Confirmar Contraseña -->
    <section class="register-form__field-group">
      <label class="register-form__label" for="reg-confirm-password">
        Confirmar Contraseña <span class="register-form__required">*</span>
      </label>
      <input 
        class="register-form__input"
        [class.register-form__input--error]="isFieldInvalid('confirmPassword') || getPasswordMatchError()"
        type="password"
        id="reg-confirm-password"
        formControlName="confirmPassword"
        placeholder="Repite tu contraseña"
      />
      @if (isFieldInvalid('confirmPassword')) {
        <span class="register-form__error">{{ getErrorMessage('confirmPassword') }}</span>
      }
      @if (getPasswordMatchError()) {
        <span class="register-form__error">{{ getPasswordMatchError() }}</span>
      }
    </section>

    <section class="register-form__actions">
      <button 
        type="submit" 
        class="register-form__btn"
        [class.register-form__btn--loading]="isLoading()"
        [disabled]="registerForm.invalid || isLoading()"
        title="Crear nueva cuenta de usuario"
        aria-label="Crear cuenta"
      >
        @if (isLoading()) {
          <span class="register-form__spinner" aria-hidden="true"></span>
          Creando cuenta...
        } @else {
          Crear cuenta
        }
      </button>
    </section>

    <footer class="register-form__footer">
      <p class="register-form__login-text">
        ¿Ya tienes una cuenta? 
        <button 
          type="button" 
          class="register-form__login-link"
          (click)="onGoToLogin()"
          title="Ir al formulario de inicio de sesión"
          aria-label="Ir a iniciar sesión"
        >
          Inicia sesión
        </button>
      </p>
    </footer>
  </fieldset>
</form>
